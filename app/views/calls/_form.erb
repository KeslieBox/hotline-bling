<div class="form">
    <%= form_for call do |f| %>
        <%# try to turn hidden fields into url_helper method?%>
        <%= f.hidden_field :caller_id, value: call.caller_id%>
        <%= f.hidden_field :dispatcher_id, value: call.dispatcher_id%>

        <%= f.label "Date:" %><br>
        <%= f.date_field :date %><br><br>

        <% if !call.id %>
            <%= f.label "Select existing caller from the dropdown or add a new one below:"%><br>
            <%= f.collection_select :caller_id, callers, :id, :to_s, include_blank: 'None' %><br><br>
        <% end %>

        <%= f.fields_for :caller, caller do |c| %>
            <%= c.label "Caller Info:" %><br>
            <%= c.label :first_name %>
            <%= c.text_field :first_name %>

            <%= c.label :last_name %>
            <%= c.text_field :last_name %><br>

            <%= c.label :address %>
            <%= c.text_field :address %>

            <%= c.label :city %>
            <%= c.text_field :city, list: "city_autocomplete" %>
                <datalist id="city_autocomplete">
                    <% cities = [] %>
                    <% callers.each do |caller| %>
                        <% if !cities.include?(caller.city) %>
                                <% cities << caller.city %>
                                <option value="<%= caller.city %>">
                        <% end %>
                    <% end %>
                </datalist><br>

            <%= c.label :parish %>
            <%= c.text_field :parish_name, list: "parish_autocomplete" %>
                <datalist id="parish_autocomplete">
                    <% parishes.each do |parish| %>
                        <option value="<%= parish.name %>">
                    <% end %>
                </datalist>

            <%= c.label :state %>
            <%= c.collection_select :state_id, states, :id, :name, include_blank: 'None' %>
        
            <%= c.label :zipcode %>
            <%= c.text_field :zipcode %><br>

            <%= c.label :phone_number %>
            <%= c.text_field :phone_number %>

            <%= c.label "Alternative Phone Number" %>
            <%= c.text_field :phone_number2 %><br><br>
        <% end %><br>
    
        <%= f.label "Log call details here:" %><br>
        <%= f.text_area :dispatch_log %><br><br>

        <%= f.label "Select your dispatch username from dropdown:"%><br>
        <%= f.collection_select :dispatcher_id, dispatchers, :id, :username, include_blank: 'None' %><br><br>  
        
        <%= f.submit call.id ? "Edit Call" : "Add Call" %>

    <% end %>
</div>